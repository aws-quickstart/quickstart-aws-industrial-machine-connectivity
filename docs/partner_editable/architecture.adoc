This Quick Start deploys resources based on the deployment type: virtual or physical. The resources deployed for each type are shown in the following two architecture diagrams, outlined in the dotted orange box.

Deploying the *virtual* option of the {partner-product-short-name} Quick Start with default parameters builds the following {partner-product-name} environment in the AWS Cloud.

:xrefstyle: short
[#architecture-virtual]
.Architecture of the Quick Start for {partner-product-name} on AWS - virtual deployment
image::../images/IMCQuickStartArchitecture-Virtual.png[Virtual architecture]

As shown in <<architecture-virtual>>, the virtual deployment of the {partner-product-short-name} Quick Start sets up the following resources:

//TODO Marcia to change these numbers to bullets and otherwise edit to match the diagram.

//TODO Marcia: Virtual = Has VPC (applies to new or existing?). No physical deployments; everything is on the Cloud, incl Ignition EC2 instance, which mimicks the hardware. EC2 instance 1 = Ignition instance. EC2 instance 2 = Edge Gateway 

. *VPC:* The {partner-product-short-name} Quick Start can be launched in an existing default VPC or can generate a new VPC within which 2 EC2 instances are launched within a single availability zone and subnet.
. *AWS IoT Greengrass:* A Greengrass group is provisioned and deployed to the the edge gateway device (physical device or simulated with EC2 instance). This Greengrass group is configurable during AWS CloudFormation stack launch to include a SiteWise connector that connects to the OPC UA server of the partner edge application (such as Ignition Server or KEPServerEX). The Greengrass core deployed to the edge device can be configured to route data through the SiteWise connector to AWS IoT SiteWise or by MQTT to AWS IoT Core's message broker.
. *AWS IoT Core:* AWS IoT Core can receive and route MQTT messages originating from both the partner edge software application (such as Ignition Server or KEPServerEX) or from the Greengrass core. These messages may contain the telemetry values of the PLC tags generated by the edge devices (PLCs). In the case that the Cirrus Link driver for the AMC is configured, AWS IoT Core routes messages containing the asset hierarchy (metadata) for tags defined within Ignition Server running at the edge to the AMC where they are mapped into the appropriate resources within AWS IoT SiteWise.
. *AWS IoT SiteWise:* This service maintains the industrial machine asset hierarchy information and contains a managed time series database to store all data generated by these industrial assets. It also includes a SaaS dashboard building service called Monitor. Monitor allows users to build custom dashboards for near-real-time data visualization. The AMC maps asset hierarchy data (such as plant, line,machine, tag) into SiteWise automatically as part of the Quick Start AWS CloudFormation stack launch.
. *Kinesis to S3:* Amazon Kinesis Data Firehose routes data messages from AWS IoT Core into an S3 bucket where they are stored and made available for analysis by services like Amazon QuickSight.
. *QuickSight:* With Amazon QuickSight, users can build custom business-intelligence dashboards and visualizations for data that is routed to and stored in the S3 datalake. The {partner-product-short-name} Quick Start provides a data-ingestion route to S3 by default. Users can adapt and extend this basic Quick Start to suit their needs.
. *Asset Model Converter (AMC):* The AMC is a serverless workflow that ingests asset hierarchy definition files/messages generated by the partner edge applications and converts them into a schema compatible with AWS IoT SiteWise's asset model definition schema. The AMC automatically generates asset models within sitewise, creates unique assets from those models and then links all assets together in a well-defined hierarchy that mirrors the industrial assets at the customer facility (such as factory, lines, machines, and tags). The AMC integrates additional partner edge applications with minimal effort. The AMC architecture diagram is shown in <<amc-architecture>>. 

//TODO Shivansh, For this list, should we asterisk any of these elements and add this footnote? [.small]#*The template that deploys the Quick Start into an existing VPC skips the components marked by asterisks and prompts you for your existing VPC configuration.#

To deploy in a customer environment, you choose the *physical* {partner-product-short-name} Quick Start deployment, as shown in <<architecture-physical>>. The key difference from the virtual deployment type (<<architecture-virtual>>) is that the AWS IoT Greengrass Core is running on a physical industrial PC device at the customer's facility. 

[#architecture-physical]
.Architecture of the Quick Start for {partner-product-name} on AWS - physical deployment
image::../images/IMCQuickStartArchitecture-Physical.png[Physical architecture]

//TODO Marcia: Label other "PLCs" icon. * Cloud component + *physical *deployment (scripts on large computer on the floor) * No VPC here. * Where's the AWS Data Lake icon in this cloudâ€”from previous fig? Focus on orange dotted box (what's deployed in this QS). Deployment doesn't include SageMaker ML; people could feed data through SageMaker ML. They could deploy it separately if they want to. Key component: AMC (Asset Model Converter): will discuss in following figure. Edge device in the factory. For deployments in customer environments, users will deploy the *PHYSICAL* deployment type of the IMC Quick Start. The key difference from the *VIRTUAL* deployment type (shown above) is that the AWS IoT Greengrass Core is running on a physical industrial PC device at the customer's facility. AMC isn't detailed as it is in next fig. Inner dotted blue line around the two service icons not helpful.

As shown in <<architecture-physical>>, the physical deployment of the Quick Start deploys the same resources as the virtual deployment but with the following differences:

* No EC2 instances are launched in a VPC in the AWS Cloud. Instead, AWS IoT Greengrass is installed (by a bootstrap installation script that is provided as part of the AWS CloudFormation stack launch) directly onto the industrial PC hardware running in the customer's facility.
* Edge applications (Ignition Serve, KEPServerEX, etc.) communicate with PLCs, historians, databases, and IoT devices running in the customer facility.
* The user can choose to connect to either Ignition Server or KEPServerEX depending on what the customer use case requires.
* The rest of the resources remain the same as those in the virtual deployment type.

//TODO Shivansh, For this list, should we asterisk any of these elements and add this footnote? [.small]#*The template that deploys the Quick Start into an existing VPC skips the components marked by asterisks and prompts you for your existing VPC configuration.#

A key component of the {partner-product-short-name} Quick Start, whether virtual or physical, is the Asset Model Converter (AMC), shown in <<amc-architecture>>. The AMC architecture converts the asset hierarchy information defined in the edge application (Ignition Server, KEPServerEX, etc.) and provisions the matching asset hierarchy in SiteWise. The AMC architecture includes a sequence flow for the SiteWise resource provisioning.

//TODO Marcia: Reduce the number of "(AMC)" in parens instances throughout.

[#amc-architecture]
.Asset Model Converter (AMC) architecture diagram
image::../images/AMCArchitecture.png[AMC architecture]

//TODO Marcia: In diagram, how is "plant facility" diff from "factory"? Shivansh says they're synonyms; go with "factory." Align language in body text.

The following table details the AMC sequence flow:

[cols="2,4a,8a"]
.AMC Sequence flow
|===
|*Step*
|*Activity*
|*Description*

|1(a)
|Upload path 1
|Automated AMC asset hierarchy ingest

|1(b)
|Upload path 2
|Manual AMC file definition upload to S3 upload

|2
|Ingest Lambda
|Ingest Lambda routes tag definition payloads into S3 bucket
Source: functions/source/AssetModelIngestion/assetModelIngestion.py

|3
|Object upload event
|Object upload event initiates conversion or provisioning Lambda

|4
|Asset hierarchy conversion
|Convert input asset hierarchy definition to DynamoDB table items (conforming to SiteWise asset model and asset definition structure)

|5
|SiteWise resource provisioning
|Provision resources in SiteWise based on updated DynamoDB table items
Source: functions/source/AssetModelConverter/createSitewiseResources.py

|===


