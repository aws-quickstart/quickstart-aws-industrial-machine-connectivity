// If no preparation is required, remove all content from here

//==== Prepare your AWS account

//_Describe any setup required in the AWS account prior to template launch_

//==== Prepare your {partner-company-name} account

//_Describe any setup required in the partner portal/account prior to template launch_

//TODO Marcia to check the nested heading levels here and throughout in the generated doc.

== Prepare for the deployment

=== Deployment configurations

The {partner-product-short-name} Quick Start has three categories of deployment configurations:

. Deployment type: 
.. <<Virtual>>
.. Physical
... <<Physical-Greenfield>>
... <<Physical-Brownfield>>
. Dataflow option:
.. <<Option 1 (OPC-UA to SiteWise)>>
.. <<Option 2a (MQTT to IoT Core)>>
.. <<Option 2b (MQTT to Greengrass to IoT Core)>>
. AMC driver: 
.. <<IgnitionCirrusLink>>
.. <<IgnitionFileExport>>
.. <<KepwareFileExport>>

==== Virtual deployment

The virtual deployment is intended for demonstration, training and evaluation of the {partner-product-short-name} Quick Start's capabilities. EC2 instances are launched to simulate edge gateway hardware but in all other respects the experience mirrors that of the physical deployment. This deployment mode relies on simulated tag values generated by the partner edge software. There are no physical PLCs or sensors that are being connected.

==== Physical deployment

With physical deployment of the {partner-product-short-name} Quick Start, users deploy edge software (such as AWS IoT Greengrass and partner edge software) on physical industrial PCs that are ready to connect to physical devices (such as PLCs) or historians or SCADA systems on the customer's plant floor. The physical deployment has two types: Greenfield and Brownfield.

===== Physical-Greenfield

* AWS IoT Greengrass and the partner edge software runs on a single industrial PC with Ignition Server installed alongside Greengrass on the same edge device.

===== Physical-Brownfield

* AWS IoT Greengrass runs standalone on an industrial PC and connects to partner edge software application that is already running on the customer's premises (such as on a virtual machine in the server room of a manufacturing plant). We assume our access to the hardware is limited or nonexistent, and our ability to reconfigure the edge software application server is limited to additive changes only.

The type of deployment (virtual or physical) determines whether to use physical edge hardware (physical industrial PCs) or virtual edge hardware (EC2) and how connectivity and security is configured. All other cloud-based resources are largely the same.

==== Dataflow options

In addition to the virtual-physical edge hardware distinction, the {partner-product-short-name} Quick Start supports three types of dataflow architectures. Each type outlines different methods of data ingestion from the edge environment into the AWS Cloud. 

===== Option 1 (OPC-UA to SiteWise)

In this variant, we have the AWS Greengrass SiteWise Connector configured to connect to the Edge Software Application OPCUA Server. All telemetry data flows directly into AWS IoT SiteWise.

===== Option 2a (MQTT to IoT Core)

In this variant, the edge software application server has some kind functionality to connect to IoT Core from MQTT. All telemetry data is pushed from the edge software application server to AWS IoT Core, and from there usually pushed to S3 or a similar data lake for processing. 

NOTE: In Option 2a, data is not forwarded to AWS IoT SiteWise. Custom development is required to populate data in AWS IoT SiteWise.

===== Option 2b (MQTT to Greengrass to IoT Core)

This variant is almost identical to previous one (option 2a), except we instead have the edge software application server pushing MQTT data messages to the Greengrass Core first, and then those messages are forwarded on to AWS IoT Core.

NOTE: In Option 2a, data is not forwarded to AWS IoT SiteWise. Custom development is required to populate data in AWS IoT SiteWise.

==== AMC driver options
The Asset Model Converter (AMC) driver determines which edge software application the {partner-product-short-name} Quick Start connects to SiteWise. You can choose any of the three AMC drivers: IgnitionCirrusLink, IgnitionFileExport, and KepwareFileExport.

===== IgnitionCirrusLink
This AMC driver uses the Cirrus Link transmission module running on Ignition Server to publish birth certificates for all devices defineed with Ignition Server's tag database. This module follows the Sparkplug version B specification for MQTT. This AMC driver runs automatically during the {partner-product-short-name} Quick Start deployment, so SiteWise resources are created automatically when the {partner-product-short-name} Quick Start is deployed.

* In the AWS CloudFormation stack `AMCDriver` parameter, choose *IgnitionCirrusLink*.

===== IgnitionFileExport
This AMC driver uses the manual tag definition file export mechanism within Ignition Server. With this AMC driver option, during the post-deployment steps, users manually export the tag definition file and upload it to an S3 bucket to initiatve the AMC process. 

* In the AWS CloudFormation stack `AMCDriver` parameter, choose *IgnitionFileExport*.

===== KepwareFileExport
This AMC driver uses the manual tag definition file export mechanism within Kepware. With this AMC driver option, during the post-deployment steps, you manually export the tag definition file and upload it to an S3 bucket to initiate the AMC process. 

* In the AWS CloudFormation stack `AMCDriver` parameter, choose *KepwareFileExport*.

//Describe the enumerated deployment configurations
//TODO Marcia: Should this come earlier?
To deploy the {partner-product-short-name} Quick Start, consider the three deployment dimensions described earlier:

* *Deployment type:* virtual or physical
* *Dataflow options:* 1, 2a, or 2b
* *AMC driver:* IgnitionCirrusLink, IgnitionFileExport, KepwareFileExport

==== Physical deployment configurations
You need the following resources for the physical deployment post-deployment steps. These are the bootup script names used for the four types of physical deployments. Choose the one that corresponds to the deployment configuration you chose during the AWS CloudFormation stack launch.

//TODO Marcia to check what's in these brackets.

===== BootupScriptGreenfieldOption1 
* Description: Deployment Type = <<Physical-Greenfield>>, Data Flow Option = <<Option 1 (OPC-UA to SiteWise)>>

===== BootupScriptGreenfieldOption2a
* Description: Deployment Type = <<Physical-Greenfield>>, Data Flow Option = <<Option 2a (MQTT to IoT Core)>>

===== BootupScriptGreenfieldOption2b
* Description: Deployment Type = <<Physical-Greenfield>>, Data Flow Option = <<Option 2b (MQTT to Greengrass to IoT Core)>>

===== BootupScriptBrownfieldAllOptions
* Description: Deployment Type = <<Physical-Brownfield>>, Data Flow Option = ANY (<<Option 1 (OPC-UA to SiteWise)>>, <<Option 2a (MQTT to IoT Core)>>, <<Option 2b (MQTT to Greengrass to IoT Core)>>)

=== Prelaunch steps
Prior to launching 1 of the 3 launch configurations complete the following prerequisite steps:

==== Sign in to your AWS account

- Sign in to your AWS account at https://aws.amazon.com with an IAM user role that has the necessary permissions.

==== AWS account with SSO enabled and user created:
- Enable AWS SSO if it has not already been enabled in the Region where you are launching the AWS CloudFormation stack.
.	Sign in to the AWS Console, and open the SSO service.
.. Make sure that you are in the Region where you are launching the AWS CloudFormation stack.
. Choose *Enable AWS SSO*.


.SSO activation page in the AWS Console
[link=images/SSO_signup.png]
image::../images/SSO_signup.png[SSO signup]

If you don't have an AWS organization set up for your account (required for AWS SSO usage), you'll be prompted to set one up. 

- Choose *Create AWS organization*. 

.SSO activation page in the AWS Console
[link=images/Enable_SSO.png]
image::../images/Enable_SSO.png[Enable SSO]

For details, see the https://docs.aws.amazon.com/singlesignon/latest/userguide/getting-started.html[AWS Single Sign-on User Guide^].

- Create an SSO group:
•	After SSO is enabled in the Region where you are launching the {partner-product-short-name} Quick Start, open the SSO service in the AWS Console. 
•	Choose *Groups* in the navigation bar. 
•	If no groups exist, choose the *Create group* button.

.Create SSO group name
[link=images/SSO_create_group.png]
image::../images/SSO_create_group.png[SSO create group]

•	Give the group a name and choose *Create*.


.Specify SSO group name
[link=images/SSO_group_name.png]
image::../images/SSO_group_name.png[SSO group name]


- Create an SSO user:
•	Sign in top the AWS Console, and open the SSO service.
•	Choose *Users* in the left-hand navigation bar.
•	Choose the blue *Add user* button.

.Add SSO user
[link=images/SSO_add_user.png]
image::../images/SSO_add_user.png[SSO add user]

•	Provide a user name and fill out the remaining fields

.Provide SSO user details
[link=images/SSO_user_details.png]
image::../images/SSO_user_details.png[SSO user details]

•	Choose *Next: Groups*.
•	Choose a group, then choose *Add user*.

The SSO user should now be active. This use can now access the SiteWise Monitor dashboards, as described in the final part of the {partner-product-short-name} stack launch procedure.

==== QuickSight setup

Open the QuickSight console, and choose *Sign up for QuickSight*.

.QuickSight signup
[link=images/QS-Signup.png]
image::../images/QS-Signup.png[QS signup]

Choose either *Standard* or *Enterprise*. 

* Choose *Continue*.
* Choose the Region you plan to deploy the {partner-product-short-name} Quick Start into. 
* Choose *Finish*.

.QuickSight - Create account
[link=images/QS-CreateAccount.png]
image::../images/QS-CreateAccount.png[QS create account]

QuickSight is now enabled and is ready for use.

==== EC2 SSH key pair
If you do not already have an EC2 SSH key pair available (PEM file format), create one in the Region where you are launching the AWS CloudFormation stack. For instructions on how to create an EC2 SSH key pair, see https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html[Amazon EC2 key pairs and Linux instances^].

//TODO Marcia to edit subheads for capitalization.

==== Create IoT SiteWise service-linked role: 
- Run the following command from the AWS CLI:

`+aws iam create-service-linked-role --aws-service-name iotsitewise.amazonaws.com --description "Service-linked role to support IoT SiteWise"+`

- For more information about creating service-linked-roles, see https://docs.aws.amazon.com/iot-sitewise/latest/userguide/using-service-linked-roles.html[Using service-linked roles for AWS IoT SiteWise^].

==== Edge hardware prerequisites
These prerequisite steps apply tp physical deployments only.

. Connect to your physical hardware running Ubuntu 18.04. Make sure that it's connected to the internet, and configure the AWS CLI:
.. Achieve this either by an SSH command or a connection to the device with a keyboard and monitor.
.. Ensure that you can connect to the internet.
.. Configure the AWS CLI on the hardware to communicate with the AWS account you plan to deploy in. For details, see https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html[Configuring the AWS CLI^].
. Ensure the directory structure of the physical hardware running Ubuntu 18.04 looks like the following:
....
home/
    ubuntu
....

For Physical-Brownfield deployments with Ignition, ensure that you are using these minimum software versions:
* Ignition: 8.0.12
* Cirrus Link MQTT Transmission Module: 4.0.4-SNAPSHOT (b2020051210)
